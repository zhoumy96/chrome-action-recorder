# 操作记录器 Chrome 扩展

![扩展图标](images/icon128.png)

一款用于记录用户操作行为、监控存储错误与网络请求的浏览器扩展，支持一键生成分析报告与截图。

---

## 功能特性

### 🖱️ 用户行为记录
- 自动追踪点击（`click`）、输入（`input`）、表单变更（`change`）等事件
- 记录元素路径、坐标、输入内容等详细信息
- 智能合并连续操作（如连续输入）

### 📸 自动化报告
- 生成带时间戳的操作分析报告
- 自动截取当前页面截图
- 支持导出原始数据（JSON格式）

### 🚨 错误监控
- 捕获 `localStorage`/`sessionStorage` 操作异常
- 监控网络请求错误（HTTP 400/500 等状态码）
- 识别业务逻辑错误（非200状态的成功响应）

### 📥 一键导出
- 支持导出：
    - 操作日志 + 截图
    - Storage错误报告
    - 网络请求错误日志
    - 自定义Avaya日志（需页面支持）

---

## 安装指南

1. 下载扩展文件到本地
2. 访问 Chrome 浏览器地址栏输入：`chrome://extensions`
3. 开启右上角 **开发者模式**
4. 点击 **加载已解压的扩展程序**
5. 选择包含所有代码文件的目录

> 需要授予权限：活动标签页、下载、存储、脚本执行

---

## 使用方法

点击工具栏图标打开控制面板：

- **捕获最近操作和截图**  
  生成包含操作记录与当前页面的分析报告

- **下载Avaya日志**  
  需页面实现 `window.myDBExport` 方法（电话系统专用）

- **下载Storage错误日志**  
  查看localStorage/sessionStorage操作异常与存储详情

- **下载错误网络请求**  
  导出HTTP错误请求与异常响应内容

---

## 技术实现

### 核心模块
- **UserActionRecorder**  
  通过事件监听记录DOM操作
- **StorageRecorder**  
  重写Storage API实现错误监控
- **ErrorRequestMonitor**  
  劫持XHR/fetch监控网络异常
- **ReportGenerator**  
  生成可读性强的操作分析报告

### 数据存储
- 使用 `chrome.storage.local` 存储操作记录
- 按域名隔离数据（`storage_[host]_actions`）
- 自动清理最早记录（最大保留100条）

---

## 注意事项

- 截图功能需要页面允许跨域资源加载
- 大文件请求体（>1MB）会被自动截断
- 扩展需保持启用状态以持续监控
- 敏感信息可能被记录，请谨慎分享日志

---

## 许可协议

[MIT License](LICENSE) © 2023